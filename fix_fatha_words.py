#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import json

# قراءة الملف
with open('/Users/ahmadalsaadi/Documents/gitRepo/kidsRead/docs/data/words.json', 'r', encoding='utf-8') as f:
    words = json.load(f)

FATHA = '\u064E'  # َ

def is_arabic_letter(char):
    """تحقق: هل هذا حرف عربي؟"""
    return '\u0621' <= char <= '\u064A' and char not in ['\u064E', '\u0650', '\u064F', '\u0652', '\u0651', '\u064B', '\u064D', '\u064C']

def has_only_fatha_on_each_letter(word):
    """
    تحقق: هل كل حرف في الكلمة يحمل فتحة فقط؟
    يجب أن:
    - كل حرف يليه فتحة (ما عدا الأخير مقبول بدون)
    - لا يوجد شدة، سكون، كسرة، ضمة، تنوين
    - لا يوجد ألف مقصورة (ى)
    - العدد الفعلي للأحرف = 3
    """
    # فحص سريع للرموز المحظورة
    if 'ى' in word or 'ّ' in word or 'ْ' in word or 'ِ' in word or 'ُ' in word or 'ً' in word or 'ٍ' in word or 'ٌ' in word:
        return False
    
    letters_only = [c for c in word if is_arabic_letter(c)]
    if len(letters_only) != 3:
        return False
    
    # التحقق من أن كل حرف (ما عدا الأخير) يليه فتحة
    i = 0
    letter_count = 0
    while i < len(word):
        if is_arabic_letter(word[i]):
            letter_count += 1
            if letter_count < 3:  # الحرفان الأول والثاني يجب أن يكون عليهما فتحة
                if i + 1 >= len(word) or word[i + 1] != FATHA:
                    return False
            i += 1
        else:
            i += 1
    
    return True

# فلترة الكلمات الثلاثية الصحيحة فقط
three_letter_fatha_correct = []
three_letter_fatha_removed = []

for word_obj in words:
    if word_obj['length'] == 3 and word_obj['diacriticType'] == 'FATHA':
        if has_only_fatha_on_each_letter(word_obj['word']):
            three_letter_fatha_correct.append(word_obj)
        else:
            three_letter_fatha_removed.append(word_obj)

print(f"✅ كلمات ثلاثية صحيحة (بفتحة فقط): {len(three_letter_fatha_correct)}")
print(f"❌ كلمات ثلاثية تم إزالتها: {len(three_letter_fatha_removed)}")

if three_letter_fatha_removed:
    print("\nالكلمات المحذوفة:")
    for w in three_letter_fatha_removed[:20]:  # عرض أول 20
        print(f"  ID {w['id']}: {w['word']}")
    if len(three_letter_fatha_removed) > 20:
        print(f"  ... و {len(three_letter_fatha_removed) - 20} كلمة أخرى")

# التحقق من التكرار
word_texts = [w['word'] for w in three_letter_fatha_correct]
duplicates = {}
for w in word_texts:
    if word_texts.count(w) > 1:
        ids = [wobj['id'] for wobj in three_letter_fatha_correct if wobj['word'] == w]
        duplicates[w] = ids

if duplicates:
    print(f"\n❌ كلمات مكررة: {len(duplicates)}")
    for word, ids in list(duplicates.items())[:10]:
        print(f"  {word}: IDs {ids}")
else:
    print("\n✅ لا يوجد تكرار")

# إنشاء قائمة كلمات جديدة صحيحة 100%
new_words_to_add = [
    "بَدَأَ", "بَرَزَ", "بَصَقَ", "بَطَلَ", "بَلَغَ",
    "تَرَبَ", "تَعَبَ", "تَلَفَ", "تَمَمَ", "ثَبَتَ",
    "جَحَدَ", "جَزَعَ", "جَفَّ", "جَمَدَ", "جَهَدَ",
    "حَجَزَ", "حَدَثَ", "حَرَقَ", "حَزَمَ", "حَسَبَ",
    "حَسَدَ", "حَفَلَ", "حَقَدَ", "حَكَمَ", "حَلَفَ",
    "خَبَأَ", "خَدَعَ", "خَرَبَ", "خَزَنَ", "خَسَرَ",
    "خَشَعَ", "خَطَأَ", "خَطَبَ", "خَطَفَ", "خَلَطَ",
    "دَبَرَ", "دَرَجَ", "دَفَقَ", "دَقَّ", "دَلَفَ",
    "ذَبَلَ", "ذَرَفَ", "ذَكَرَ", "ذَلَّ", "ذَهَنَ",
    "رَبَحَ", "رَتَبَ", "رَحَلَ", "رَزَقَ", "رَشَحَ",
    "رَصَدَ", "رَفَضَ", "رَقَدَ", "رَكَبَ", "رَمَحَ",
    "زَجَرَ", "زَرَقَ", "زَعَجَ", "زَفَرَ", "زَمَجَرَ",
    "سَجَدَ", "سَجَلَ", "سَحَقَ", "سَرَقَ", "سَطَحَ",
    "سَعَدَ", "سَفَرَ", "سَكَبَ", "سَكَتَ", "سَمَحَ",
    "شَجَعَ", "شَحَنَ", "شَرَحَ", "شَطَبَ", "شَعَرَ",
    "شَكَلَ", "شَمَلَ", "شَهَدَ", "شَهَقَ", "صَبَرَ",
    "صَحَبَ", "صَدَقَ", "صَرَفَ", "صَفَحَ", "صَلَبَ",
    "صَنَعَ", "صَهَرَ", "ضَجَرَ", "ضَحَّ", "ضَرَبَ",
    "ضَعَفَ", "ضَلَّ", "ضَمَدَ", "طَبَعَ", "طَرَحَ",
    "طَرَدَ", "طَرَقَ", "طَلَعَ", "طَمَرَ", "طَهَرَ",
    "ظَفَرَ", "ظَلَمَ", "ظَهَرَ", "عَبَدَ", "عَجَبَ",
    "عَجَزَ", "عَدَدَ", "عَدَلَ", "عَذَبَ", "عَزَبَ",
    "عَزَفَ", "عَزَلَ", "عَزَمَ", "عَسَرَ", "عَشَقَ",
    "عَطَسَ", "عَطَفَ", "عَقَدَ", "عَقَلَ", "عَكَسَ",
    "عَمَدَ", "عَمَلَ", "غَدَرَ", "غَرَبَ", "غَرَقَ",
    "غَزَلَ", "غَسَقَ", "غَشَّ", "غَضَّ", "غَلَبَ",
    "غَلَطَ", "غَلَقَ", "غَمَزَ", "غَنَمَ", "فَجَرَ",
    "فَحَصَ", "فَخَرَ", "فَرَحَ", "فَرَزَ", "فَرَشَ",
    "فَرَضَ", "فَرَقَ", "فَزَعَ", "فَسَخَ", "فَسَدَ",
    "فَصَلَ", "فَضَحَ", "فَضَلَ", "فَطَرَ", "فَقَدَ",
    "فَلَحَ", "فَنَدَ", "فَهَدَ", "قَبَحَ", "قَبَضَ",
    "قَبَلَ", "قَتَلَ", "قَحَطَ", "قَدَحَ", "قَذَفَ",
    "قَرَحَ", "قَرَصَ", "قَرَضَ", "قَسَطَ", "قَسَمَ",
    "قَصَدَ", "قَصَرَ", "قَصَفَ", "قَطَفَ", "قَفَلَ",
    "قَلَبَ", "قَلَدَ", "قَمَحَ", "قَهَرَ", "كَبَحَ",
    "كَبَرَ", "كَتَمَ", "كَثَرَ", "كَحَلَ", "كَذَبَ",
    "كَرَبَ", "كَسَبَ", "كَشَطَ", "كَفَرَ", "كَفَلَ",
    "كَمَلَ", "كَنَزَ", "كَنَسَ", "كَهَنَ", "لَبَثَ",
    "لَثَمَ", "لَحَسَ", "لَحَظَ", "لَحَقَ", "لَدَغَ",
    "لَزَقَ", "لَسَعَ", "لَصَّ", "لَعَنَ", "لَفَحَ",
    "لَفَظَ", "لَقَحَ", "لَمَحَ", "لَهَبَ", "لَهَثَ",
    "مَجَدَ", "مَحَصَ", "مَحَقَ", "مَدَحَ", "مَرَحَ",
    "مَزَحَ", "مَزَقَ", "مَسَدَ", "مَشَطَ", "مَصَّ",
    "مَلَحَ", "مَنَحَ", "نَبَتَ", "نَبَذَ", "نَتَجَ",
    "نَجَحَ", "نَحَبَ", "نَحَتَ", "نَحَرَ", "نَحَسَ",
    "نَخَرَ", "نَدَبَ", "نَدَمَ", "نَزَحَ", "نَزَعَ",
    "نَزَفَ", "نَسَجَ", "نَسَفَ", "نَشَبَ", "نَشَدَ",
    "نَشَرَ", "نَشَطَ", "نَصَحَ", "نَصَرَ", "نَضَجَ",
    "نَطَحَ", "نَطَفَ", "نَطَقَ", "نَظَمَ", "نَعَبَ",
    "نَعَسَ", "نَعَقَ", "نَفَثَ", "نَفَخَ", "نَفَدَ",
    "نَفَرَ", "نَفَسَ", "نَفَعَ", "نَقَبَ", "نَقَحَ",
    "نَقَدَ", "نَقَرَ", "نَقَزَ", "نَقَشَ", "نَقَصَ",
    "نَقَضَ", "نَقَعَ", "نَقَلَ", "نَكَتَ", "نَكَثَ",
    "نَكَحَ", "نَكَسَ", "نَمَرَ", "نَهَبَ", "نَهَجَ",
    "نَهَضَ", "نَهَقَ", "نَوَحَ", "هَبَطَ", "هَجَرَ",
    "هَجَمَ", "هَدَرَ", "هَذَبَ", "هَرَمَ", "هَزَجَ",
    "هَزَرَ", "هَزَلَ", "هَزَمَ", "هَلَعَ", "هَلَكَ",
    "هَمَدَ", "هَمَزَ", "هَمَسَ", "وَجَبَ", "وَجَدَ",
    "وَجَعَ", "وَجَلَ", "وَجَمَ", "وَجَهَ", "وَحَدَ",
    "وَخَزَ", "وَدَعَ", "وَرَدَ", "وَرَثَ", "وَزَرَ",
    "وَزَعَ", "وَزَنَ", "وَسَخَ", "وَسَطَ", "وَسَعَ",
    "وَسَمَ", "وَشَحَ", "وَشَمَ", "وَصَفَ", "وَصَلَ",
    "وَضَحَ", "وَطَأَ", "وَعَدَ", "وَعَظَ", "وَقَحَ",
    "وَقَدَ", "وَقَرَ", "وَكَزَ", "وَكَلَ", "وَلَعَ",
    "وَلَهَ", "وَهَبَ", "وَهَجَ", "وَهَدَ", "وَهَمَ",
    "وَهَنَ", "يَبَسَ", "يَتَمَ", "يَسَرَ", "يَقَظَ"
]

print(f"\nكلمات جديدة للإضافة: {len(new_words_to_add)}")
print(f"العدد المطلوب للحذف: {len(three_letter_fatha_removed)}")
print(f"سنضيف: {min(len(new_words_to_add), len(three_letter_fatha_removed))} كلمة")

# التحقق من صحة الكلمات الجديدة
valid_new_words = []
for word in new_words_to_add:
    if has_only_fatha_on_each_letter(word) and word not in word_texts:
        valid_new_words.append(word)

print(f"كلمات جديدة صحيحة: {len(valid_new_words)}")

# إنشاء قاعدة البيانات الجديدة
# 1. نحتفظ بالكلمات غير الثلاثية بفتحة
other_words = [w for w in words if not (w['length'] == 3 and w['diacriticType'] == 'FATHA')]

# 2. نضيف الكلمات الثلاثية الصحيحة
final_words = other_words + three_letter_fatha_correct

# 3. نضيف الكلمات الجديدة
last_id = max(w['id'] for w in final_words)
for i, new_word in enumerate(valid_new_words[:len(three_letter_fatha_removed)], start=1):
    final_words.append({
        "id": last_id + i,
        "word": new_word,
        "length": 3,
        "diacriticType": "FATHA"
    })

# إعادة ترتيب IDs
final_words.sort(key=lambda x: x['id'])

print(f"\nالعدد النهائي للكلمات: {len(final_words)}")
print(f"كلمات ثلاثية بفتحة نهائية: {len([w for w in final_words if w['length'] == 3 and w['diacriticType'] == 'FATHA'])}")

# حفظ الملف
with open('/Users/ahmadalsaadi/Documents/gitRepo/kidsRead/docs/data/words.json', 'w', encoding='utf-8') as f:
    json.dump(final_words, f, ensure_ascii=False, indent=2)

print("\n✅ تم حفظ الملف بنجاح!")
